# 認証画面・ダッシュボード実装レポート

## 概要

PeopleBoosterの認証画面（ログイン、パスワードリセット）とロール別ダッシュボードを実装しました。すべてのコンポーネントはTypeScriptコンパイルチェックをパスしています。

## 実装ファイル一覧

### 認証画面

| ファイル | 説明 |
|---------|------|
| `src/app/(auth)/login/page.tsx` | 一般ユーザー向けログイン画面 |
| `src/app/admin/login/page.tsx` | システム管理者向けログイン画面 |
| `src/app/(auth)/password-reset/page.tsx` | パスワードリセット画面 |

### ダッシュボード

| ファイル | 説明 |
|---------|------|
| `src/app/(dashboard)/page.tsx` | ロール別ダッシュボードルーティング |
| `src/components/dashboard/SystemAdminDashboard.tsx` | システム管理者用ダッシュボード |
| `src/components/dashboard/CompanyAdminDashboard.tsx` | 企業管理者用ダッシュボード |
| `src/components/dashboard/CompanyUserDashboard.tsx` | 企業ユーザー用ダッシュボード |
| `src/components/dashboard/GeneralUserDashboard.tsx` | 一般ユーザー用ダッシュボード |

## 認証画面の機能

### ログイン画面 (`/login`)

**機能:**
- メールアドレス・パスワード入力
- パスワード表示/非表示切り替え
- ログインボタン（ローディング状態対応）
- パスワードを忘れた方リンク
- MFA認証コード入力（MFA有効時）
- エラーメッセージ表示
- ログイン成功後のリダイレクト

**デザイン:**
- グラデーション背景（青〜インディゴ）
- カード形式のフォーム
- レスポンシブ対応

### システム管理者ログイン画面 (`/admin/login`)

**機能:**
- 一般ログインと同様の機能
- システム管理者専用のUI

**デザイン:**
- グラデーション背景（スレート〜グレー）
- 「システム管理」ラベル表示
- 一般ログインへのリンク

### パスワードリセット画面 (`/password-reset`)

**機能:**
- メールアドレス入力によるリセットリンク送信
- トークン付きURLでの新パスワード設定
- パスワード確認入力
- 送信完了メッセージ表示
- ログイン画面へのリンク

## ダッシュボードの機能

### システム管理者用ダッシュボード

**統計情報:**
- アクティブ企業数（前月比変化率）
- 総ユーザー数（前月比変化率）
- 月間診断完了数（前月比変化率）
- 月間売上（前月比変化率）

**グラフ:**
- 売上推移グラフ（目標との比較）
- 新規登録推移グラフ（企業・ユーザー）

**システムアラート:**
- エラー、警告、情報の3種類
- タイムスタンプ付き

### 企業管理者用ダッシュボード

**統計情報:**
- 診断完了率（プログレスバー付き）
- 採用パイプライン人数
- 今週の面接予定数
- プラン利用状況

**組織傾向サマリー:**
- ビッグファイブ平均値のレーダーチャート

**採用パイプライン:**
- ステージ別の候補者数表示
- 各ステージへのリンク

**今週の面接予定:**
- 日付、候補者名、ポジション、面接官表示
- 詳細へのリンク

**プラン利用状況:**
- 診断枠の使用状況（プログレスバー）
- 残り診断枠数表示

### 企業ユーザー用ダッシュボード

**統計情報:**
- 担当候補者数
- 今日の面接件数
- アクション待ち件数
- 完了した面接数（今月）

**今日の面接:**
- 時刻、候補者名、ポジション表示
- 面接タイプ（ビデオ/対面/電話）
- 参加ボタン

**アクション必要な候補者:**
- フィードバック入力待ち
- 面接日程調整待ち
- 書類確認待ち
- 期限表示

### 一般ユーザー用ダッシュボード

**診断ステータス:**
- 未開始: 診断開始ボタン
- 進行中: 進捗バー、再開ボタン
- 完了: 結果確認リンク

**診断結果サマリー（完了時）:**
- ビッグファイブレーダーチャート
- パーソナリティタイプ
- 強み・成長領域

**外部診断入力状況:**
- ストレングスファインダー
- MBTI
- エニアグラム
- 入力済み/未入力のステータス表示

## 技術的な実装詳細

### 状態管理

```typescript
// ダッシュボードページでのロール別表示
switch (user.role) {
  case 'SYSTEM_ADMIN':
    return <SystemAdminDashboard />;
  case 'COMPANY_ADMIN':
    return <CompanyAdminDashboard />;
  case 'COMPANY_USER':
    return <CompanyUserDashboard />;
  case 'GENERAL_USER':
  default:
    return <GeneralUserDashboard />;
}
```

### データフェッチング

各ダッシュボードコンポーネントでは、TanStack Queryを使用してデータをフェッチしています。現在はモックデータを返す関数を使用していますが、実際のAPI呼び出しに置き換え可能です。

```typescript
const { data: stats, isLoading } = useQuery({
  queryKey: ['system-stats'],
  queryFn: fetchSystemStats,
});
```

### 認証フロー

1. ユーザーがログインフォームに入力
2. `useAuth`フックの`login`関数を呼び出し
3. MFAが必要な場合、MFA入力フォームを表示
4. 認証成功後、`/dashboard`にリダイレクト
5. ダッシュボードページでユーザーのロールに応じたコンポーネントを表示

## URL構造

| URL | 説明 | 対象ユーザー |
|-----|------|-------------|
| `/login` | 一般ログイン | 全ユーザー |
| `/admin/login` | 管理者ログイン | システム管理者 |
| `/password-reset` | パスワードリセット | 全ユーザー |
| `/dashboard` | ダッシュボード | 認証済みユーザー |

## 今後の拡張

1. **ソーシャルログイン**: Google、Microsoft等のOAuth連携
2. **セッション管理**: アクティブセッション一覧、強制ログアウト
3. **ダッシュボードカスタマイズ**: ウィジェットの並び替え、表示/非表示設定
4. **リアルタイム更新**: WebSocketによるダッシュボードデータの自動更新
5. **通知センター**: 未読通知の表示、既読管理
